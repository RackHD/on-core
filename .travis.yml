language: node_js

node_js:
  - "0.10"
  - "4"

matrix:
  allow_failures:
   - node_js: "4"

services:
  - mongodb
  - rabbitmq

env:
  global:
    secure: "jHZioI+kRZw2jOVZKw2p1Zcbw0hBCc5ecGrklfnjzXOp99I/8nr4dQB0p+qX4Wj1dRhmMnQyRzgfKkReEtxKyehBV/Pg7eYX1hs9G2YeDtyXGaBEdHZ28Ckd63NZcwPGfBukG0VnSUhasy93j299cmB0mGhlt0Sv+UQD6VS8Ym6NJqiRxV10VGjmDgdei1XYVEYRU3tVKyX7yNKcAfyvwlfhElCeIzGk5Rth/cSDlEb5mUah3Y+vmgNsklucp3kp18isTG+e1JKzOKQ1q5vJFXyjhTMRhgdZtmdrROGoUM6I6R90tOnVadS1FitPveoeQEKaL9BKyKfRY+FImcDZAyFmJCfJqRHdfLTmggrV/7GJpbg8wX+d/4HVNrU4mAgiC+28FikRc+tVsKb2fOhqDk7vgbo3nFF0DWfoT3DnBkjfmvMRyDSiTFVW1TtCbIZd/msc8ZU5p0Jse+Tufh0tI8UTTZry9BE0CVB6TlXKjMJMTbl7/H/aptBdgD3Ffp3q60RGGUYmhIVoPXv8dLC3M7wFm3DjM77fm0C9yYoLFt1Sveiif6VFfc6quDJATGkFswuOsPOM8GXzbj72agzZMrus55gfluaqMvO0m597a262Kor7Jq0MQ3avtqpPTHJFHwzYURI/AX6nzkbhjrSZp6e4oai+EnSN8NJN/EJ9Nvk="
    secure: "KUWB+x7QbAkZgm7BDdXbWGdHVs25SBnlhP8ZUO9FWbQrN/obH2bhLAjttCKmVBHzWp59mfwP2Mvi7B6GOxabKQnSIBoOpEdWfpaRiGZsgg6W4QWa1oH5UWInoToVHndSlpVuMw3mrXSwjaNCd3pLbbPwJWcpwJBxnorBHBK6GRlx09hYEmBldVuMgrHxNceqj2JypC5v/HicWQaY6ufjDtcgwxHZeUpNo52YXor/xDzit1Q7g524km2pwok9U5ic3DAnhqzP0T/TJZuE09itsTB9RlaI9LbYJ86+KcZpmjZxT+m+hiD1q9Xk4EJDH1T2DZgWkKBf56v5bHVtbBuj07x7yqAJ+yFhuYtepBf8qYf82UmdHmCZUS2GwTToBa76tAsI9/rHrWh5FfEOjmj9RPqJNdMj6lsQofpHQGTFuIwlqLzYSjVbEHjwvRHMFn14nwWdXAQJHv6PfTP3hp9a4M3yEQkzjFr6cUcjZDkL59y07x+cUx/gBqzwlWkXq8mqEwIJ8uFAhxo2OAS9+ZosbELlA6kmD3QfEpL1WxUj6Qk92KtqDnukUwwqS0yu8wdqy/SgWWtlg+QTz92ETwDZZjQFsjIl8Cq1j8n8aauS9VrcK8jKOkynjd4npkjsPd6a2apZyfPnRCxu6Eno0JHzR5UvwEN+fTY1ayJROp3f6qQ="

after_success:
 - ./node_modules/.bin/istanbul cover -x "**/spec/**" ./node_modules/.bin/_mocha --report lcovonly -- $(find spec -name '*-spec.js') -R spec --require spec/helper.js
 - cat ./coverage/lcov.info | node_modules/.bin/coveralls
 - chmod 755 ./build_children.sh
 - ./build_children.sh

notifications:
  slack:
    rooms:
    - secure: "DZ+r6cHd9kzKl0BoW2MmLnLhyPNivsjYWyRqVwjYtwNnsMZFSfQ13B6gojEw28PJmVqDu6am/bOhwD6gka8xuu5Fu7In0LMpdL4aNmV6bg/8B8CooYFG+izaa/9Cjsk9t9RG8oZggqXl/U1g4FGweczjU6UC/8WUU/QFsud1GXDZtdLm/80i+/CC1pmhKx73zcgXNWj/j4YDhTY1r3rsEM4nk5m2/CvSo9nYLY4VvTxlH1uA3OVKqDdoMPP8nX6N12qIBYJceDI8uXrBPKFfP+y6V7paq5VNIxAFYxEKkB9AUnNENgPSKvsTP0RWicstYbFosbJHw4o09e/+sui8Mj0UuK4eRfyBdTuj1/kSeUTIYCBffVLXtN5o/Hsm88Ak1Dd7gczQBXMlNQl7nXR9g38m150AMyinvyx52ZdOXiBhPRBbF9riD2fCgjxoCq8W3cVmRaU25lI/YyAMDUGaaVBVjRJCuMEMnFlXJdV2pGPIglRuPrB6llGnyCwTPNlPdsvVjWzQ6j9gV7jQb2mVvjo4c8Lvs0KI0UEAVrysWaslYd1Wgdh8HGSlPJua9Xpo7rQs5wsRqSqFwIZ038NCXWvXtZc828//KvWC+1e26puQfIjwMR/y6cqzF09h7+GkSePxYxoCqbNgSZ/u6KrOx0FOe+E4BrLl5PEtO3Y2iAg="
    on_success: never
    on_failure: always
    on_start: never
